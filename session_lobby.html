<!-- templates/session_lobby.html -->
{% extends "base.html" %}

{% block title %}Session Lobby - Mind Shelter{% endblock %}

{% block content %}
<div class="p-4 md:p-8 max-w-4xl mx-auto">
    <!-- Session Header -->
    <div class="glass-morphism rounded-3xl p-8 mb-8 text-center">
        <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center">
            <i data-lucide="users" class="w-10 h-10 text-white"></i>
        </div>
        <h1 class="text-3xl font-bold text-white mb-2">Mind Shelter Circle Ready</h1>
        <p class="text-white/80 text-lg mb-6">Your sanctuary for deep connection and reflection</p>
        
        <div class="flex justify-center gap-4 mb-6 flex-wrap">
            <div class="bg-white/20 text-white border border-white/30 px-4 py-2 rounded-full">
                Room Code: {{ session.room_code }}
            </div>
            <div class="bg-white/20 text-white border border-white/30 px-4 py-2 rounded-full">
                <i data-lucide="clock" class="w-4 h-4 mr-2 inline"></i>
                15 minutes of mindful sharing
            </div>
        </div>

        <div id="countdown-container" class="text-center">
            <div id="countdown-timer" class="text-4xl font-bold text-white mb-2">2:00</div>
            <p class="text-white/80">Your circle begins in</p>
        </div>
        
        <button id="start-session-btn" 
                class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-8 py-3 rounded-xl font-semibold text-lg hidden">
            <i data-lucide="play" class="w-5 h-5 mr-2 inline"></i>
            Enter Circle
        </button>
    </div>

    <!-- Your Profile -->
    <div class="glass-morphism rounded-2xl p-6 mb-8">
        <h3 class="text-xl font-semibold text-white mb-6">Your Reflection Profile</h3>
        
        <div class="space-y-4">
            {% if session.participants %}
            <div>
                <label class="text-white/80 text-sm font-medium">Your Chosen Metaphor</label>
                <div class="glass-morphism rounded-xl p-4 mt-2 bg-white/10">
                    <p class="text-white text-lg font-medium">"{{ session.participants[0].chosen_metaphor }}"</p>
                </div>
            </div>

            <div>
                <label class="text-white/80 text-sm font-medium">Your Reflection Prompt</label>
                <div class="glass-morphism rounded-xl p-4 mt-2 bg-white/10">
                    <p class="text-white/90">{{ session.participants[0].icebreaker_prompt }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Session Guidelines -->
    <div class="glass-morphism rounded-2xl p-6">
        <h3 class="text-xl font-semibold text-white mb-4">Session Flow</h3>
        <div class="space-y-4">
            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold">1</div>
                <div>
                    <h4 class="text-white font-medium">Opening</h4>
                    <p class="text-white/80 text-sm">2 minutes to center ourselves and create safe space</p>
                </div>
            </div>
            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold">2</div>
                <div>
                    <h4 class="text-white font-medium">Heart Sharing</h4>
                    <p class="text-white/80 text-sm">10 minutes of authentic, vulnerable storytelling</p>
                </div>
            </div>
            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold">3</div>
                <div>
                    <h4 class="text-white font-medium">Closing Moments</h4>
                    <p class="text-white/80 text-sm">3 minutes for reflection and gratitude</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let timeRemaining = 120; // 2 minutes in seconds
    const timer = document.getElementById('countdown-timer');
    const container = document.getElementById('countdown-container');
    const startBtn = document.getElementById('start-session-btn');
    
    const countdown = setInterval(() => {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        timeRemaining--;
        
        if (timeRemaining < 0) {
            clearInterval(countdown);
            container.classList.add('hidden');
            startBtn.classList.remove('hidden');
        }
    }, 1000);
    
    startBtn.addEventListener('click', function() {
        window.location.href = `/live-session?session={{ session.id }}`;
    });
});
</script>
{% endblock %}
